<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wi-Fi Scanner</title>

    <title>WiFi List</title>
<style>
    body {
    font-family: Arial, sans-serif;
    background-color:rgb(28, 28, 37);
    color: rgb(255, 224, 252);
}
.wifi-list {
    list-style: none;
    padding: 0;
}
.wifi-item {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    border-bottom: 1px solid rgb(255, 224, 252);
}
.connect-btn {
    background:#441d69;
    color: rgb(255, 224, 252);
    border: 2px solid rgb(28, 28, 37);
    border-radius: 5px;
    padding: 5px 10px;
    cursor: pointer;
}
.connect-btn:hover {
            background: rgb(255, 224, 252);
            color:rgb(28, 28, 37);
        }
.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
}
.modal {
    background: rgb(28, 28, 37);
    padding: 20px;
    width: 300px;
    text-align: center;
    border-radius: 10px;
}
.close-btn {
    color:rgb(255, 224, 252);
    float: right;
    cursor: pointer;
    font-size: 20px;
    border: none;
    background: none;
}
.send-btn {
    background: #441d69;
    color: rgb(255, 224, 252);
    padding: 10px;
    border: 2px solid rgb(28, 28, 37); /* Blue border */
    border-radius: 5px;
    cursor: pointer;
}
.send-btn:hover {
            background: rgb(255, 224, 252);
            color:rgb(28, 28, 37);
        }
input[type="password"] {
    width: 60%;
    padding: 10px;
    margin-top: 10px;
    border: 2px solid rgb(28, 28, 37); /* Blue border */
    border-radius: 5px;
    background-color: rgb(255, 224, 252); /* Light blue background */
    color: rgb(28, 28, 37); /* Darker text */
    font-size: 16px;
}

input[type="password"]:focus {
    border-color: #0056b3; /* Darker blue on focus */
    background-color: #e6f2ff; /* Even lighter blue */
    outline: none;
}

</style>
</head>
<body>
    <h1>Available WiFi Networks</h1>
    <ul class="wifi-list" id="wifiList"></ul>
    
    <div class="modal-overlay" id="popup">
        <div class="modal">
            <button class="close-btn" onclick="closePopup()">âœ–</button>
            <h2>Enter WiFi Password</h2>
            <p id="selectedSSID"></p>
            <input type="password" id="wifiPassword" placeholder="Enter password...">
            <button class="send-btn" onclick="sendWiFiCredentials()">Connect</button>
        </div>
    </div>

    <script>
        const wifiList = document.getElementById("wifiList");
        let selectedSSID = "";

        function getWiFiIcon(rssi) {
    let color;
    let bars;

    if (rssi > -70) {
        color = "green";
        bars = 5;
    } else if (rssi > -85) {
        color = "yellow";
        bars = 4;
    } else if (rssi > -100) {
        color = "orange";
        bars = 3;
    } else if (rssi > -110) {
        color = "red";
        bars = 2;
    } else {
        color = "darkred";
        bars = 1;
    }

    return `
        <svg width="24" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="vertical-align: bottom;">
            <rect x="2" y="16" width="4" height="6" fill="${bars >= 1 ? color : 'gray'}"></rect>
            <rect x="7" y="13" width="4" height="9" fill="${bars >= 2 ? color : 'gray'}"></rect>
            <rect x="12" y="10" width="4" height="12" fill="${bars >= 3 ? color : 'gray'}"></rect>
            <rect x="17" y="7" width="4" height="15" fill="${bars >= 4 ? color : 'gray'}"></rect>
            <rect x="22" y="4" width="4" height="18" fill="${bars >= 5 ? color : 'gray'}"></rect>
        </svg>
    `;
}

    function renderWiFiList(wifiNetworks) {
        wifiList.innerHTML = "";
        wifiNetworks.forEach(network => {
            let lockIcon = network.encryption == 0 ? "ðŸ”“" : "ðŸ”’";
            let listItem = document.createElement("li");
            listItem.classList.add("wifi-item");
            listItem.innerHTML = `
                <span>${getWiFiIcon(network.rssi)} ${lockIcon} ${network.ssid}</span>
                <button class="connect-btn" onclick="openPopup('${network.ssid}', ${network.encryption})">Connect</button>
            `;
            wifiList.appendChild(listItem);
        });
    }
        function openPopup(ssid, encryption) {
            selectedSSID = ssid;
            document.getElementById("selectedSSID").innerText = `SSID: ${ssid}`;
            document.getElementById("popup").style.display = "flex";
            document.getElementById("wifiPassword").hidden = (encryption == 0);
        }

        function closePopup() {
            document.getElementById("popup").style.display = "none";
        }

        function sendWiFiCredentials() {
            const password = document.getElementById("wifiPassword");
            if (!password.value && !password.hidden) {
                alert("Please enter a password!");
                return;
            }
            
            fetch(`wifi/connect?ssid=${encodeURIComponent(selectedSSID)}&password=${encodeURIComponent(password.value)}`)
                .then(response => response.text())
                .then(data => {
                    alert("Response from ESP32: " + data);
                    closePopup();
                })
                .catch(error => {
                    alert("Error connecting to WiFi");
                });
        }

        function fetchWiFiNetworks() {
            fetch('/wifi/scan')
                .then(response => response.json())
                .then(data => {
                    renderWiFiList(data);
                })
                .catch(error => {
                    console.error('Error fetching WiFi networks:', error);
                });
        }

        window.onload = fetchWiFiNetworks;
    </script>
</body>
</html>
